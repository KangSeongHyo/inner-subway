<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="board">

	<select id="getBoardOne" parameterType="com.intern.board.BoardVO"
		resultType="com.intern.board.BoardVO">
		SELECT
		scode,entryNum,title,writer,registrationDate,viewCount,content,imgPath
		FROM station_board
		where scode=#{scode} and entryNum=#{entryNum}
	</select>

	<select id="getBoardList" parameterType="com.intern.station.StationVO"
		resultType="com.intern.board.BoardVO">
		SELECT
		scode,entryNum,title,writer,registrationDate,viewCount,content,imgPath
		FROM station_board
		where scode=#{scode}
		order by entryNum desc
	</select>

	<select id="getEntryCount" parameterType="com.intern.station.StationVO"
		resultType="int">
		SELECT count(*)
		FROM station_board
		where scode=#{scode}
	</select>

	<insert id="insertBoard" parameterType="com.intern.board.BoardVO">
		INSERT INTO
		station_board(scode,title,writer,registrationDate,viewCount,content,imgPath)
		VALUES(#{scode},#{title},#{writer},sysdate(),0,#{content},#{imgPath})
	</insert>

	<delete id="deleteBoard" parameterType="com.intern.board.BoardVO">
		DELETE FROM station_board
		WHERE
		scode = #{scode} and entryNum=#{entryNum}
	</delete>

	<update id="updateBoard" parameterType="com.intern.board.BoardVO">
		UPDATE station_board
		SET
		title=#{title},content=#{content}
		<if test="imgPath!=null">
			,img_path=#{img_path}
		</if>
		WHERE
		scode = #{scode} and entryNum=#{entryNum}
	</update>

	<update id="updateViewcount" parameterType="com.intern.board.BoardVO">
		UPDATE station_board
		SET
		viewCount=viewCount+1
		WHERE
		scode = #{scode} and
		entryNum=#{entryNum}
	</update>
	
	<select id="getSearchBoard" parameterType="java.util.Map"
		resultType="com.intern.board.BoardVO">
		SELECT 
		scode,entryNum,title,writer,registrationDate,viewCount,content,imgPath
		FROM 
		(SELECT
		scode,entryNum,title,writer,registrationDate,viewCount,content,imgPath
		FROM 
		station_board
		WHERE
		scode=#{scode}
		ORDER BY 
		entryNum desc) board
		WHERE 
		title like CONCAT('%',#{search},'%') or writer like CONCAT('%',#{search},'%')
	</select>
	
	<select id="getSearchBoardCount" parameterType="java.util.Map"
		resultType="Integer">
		SELECT 
		count(*)
		FROM 
		(SELECT
		scode,entryNum,title,writer,registrationDate,viewCount,content,imgPath
		FROM 
		station_board
		WHERE
		scode=#{scode}
		ORDER BY 
		entryNum desc) board
		WHERE 
		title like CONCAT('%',#{search},'%') or writer like CONCAT('%',#{search},'%')
	</select>
	

</mapper>
